# Block Chain

The block chain provides Bitcoin’s public ledger, an ordered and timestamped record of transactions. This system is used to protect against double spending and modification of previous transaction records.¥¥

ブロックチェーンは、ビットコインの公開台帳を提供し、取引の順序とタイムスタンプの記録を提供します。このシステムは、二重支出や以前の取引記録の改ざんから保護するために使用されます。

はじめに
ビットコインネットワークの各フルノードは、独立して、そのノードによって検証されたブロックのみを含むブロックチェーンを保存します。複数のノードがすべて同じブロックを持つ場合、それらのノードは「コンセンサス<Consensus>」にあるとみなされる。これらのノードがコンセンサスを維持するために従う検証ルールを :用語:`コンセンサスルール <Consensus rules>` と呼ぶ。このセクションでは、Bitcoin Core で使用されるコンセンサスルールの多くについて説明します。

ブロックチェーン概要

上の図は、ブロックチェーンの簡略版である。1つまたは複数の新しい取引の :term:`block <Block>` がブロックの取引データ部分に集められる。各取引のコピーはハッシュ化され、ハッシュはペアリングされ、またペアリングされ、さらにハッシュ化され、一つのハッシュが残るまで続けられる。

メルクルルートはブロックヘッダに格納される。各ブロックには前のブロックのヘッダーのハッシュも格納され、ブロックが連結される。これにより、トランザクションを記録したブロックとそれに続くすべてのブロックを変更しない限り、トランザクションを変更することはできない。

取引も連鎖している。ビットコインのウォレットソフトウェアは、サトシがウォレットからウォレットに送られるように見えるが、実際にはビットコインは取引から取引に移動する。各取引は、1つまたは複数の以前の取引で受け取ったサトシを使うので、ある取引の入力は以前の取引の出力となる。

トランザクションの伝播

1つの取引は、複数のアドレスに送信する場合のように複数のアウトプットを作成することができるが、特定の取引の各アウトプットは、ブロックチェーン内で一度だけインプットとして使用することができる。それ以降の参照は禁じられた二重使用、つまり同じサトシを二度使おうとしていることになる。

出力は :term:`transaction identifiers (TXIDs) <Txid>` に関連付けられ、これは署名された取引のハッシュ値である。

特定の取引の各アウトプットは一度しか使うことができないため、ブロックチェーンに含まれるすべての取引のアウトプットは、 :term:`Unspent Transaction Outputs (UTXOs) <UTXO>` と spent transaction outputs のいずれかに分類される。支払いが有効であるためには、入力としてUTXOのみを使用しなければならない。

コインベース取引（後述）を無視すると、取引の出力値が入力値を上回った場合、その取引は拒否されるが、入力値が出力値を上回った場合、その取引を含むブロックを作成したビットコインの :term:`miner <マイニング>` がその価値の差を :term:`transaction fee <Transaction fee>` として請求することが出来る。例えば、上の図では、各トランザクションは、組み合わせたインプットから受け取るよりも少ない10,000サトシを使い、事実上10,000サトシのトランザクション手数料を支払っています。





すべてのブロックには1つ以上のトランザクションが含まれなければならない。これらの取引のうち最初のものは、世代取引とも呼ばれるコインベース取引でなければならず、ブロック報酬（ブロック補助金とこのブロックに含まれる取引によって支払われた取引手数料で構成）を集めて使う必要がある。

コインベース取引のUTXOは、少なくとも100ブロックは使われない（入力として使われない）という特別な条件を持っている。これにより採掘者は、ブロックチェーンフォーク後に古いと判断される（つまりコインベース取引が破棄される）可能性のあるブロックから取引手数料とブロック報酬を一時的に支出することができなくなる。

ブロックにはコインベース以外の取引を含める必要はないが、採掘者は取引手数料を徴収するために、ほとんどの場合、追加の取引を含めている。

コインベース取引を含む全ての取引は、バイナリの生取引形式でブロックにエンコードされる。

生の取引形式はハッシュ化されて取引識別子（txid）が作成される。これらのtxidから、各txidと他の1つのtxidを対にしてハッシュ化し、:term:`merkle tree <メルクル木>`が構築される。txidの数が奇数の場合、パートナーのいないtxidはそれ自身のコピーとハッシュ化されます。

得られたハッシュ自身はそれぞれ他のハッシュと対になり、ハッシュ化される。パートナーのいないハッシュはそれ自身とハッシュされる。このプロセスを、ただ一つのハッシュ（merkle root）が残るまで繰り返す。

たとえば、トランザクションが単に結合されているだけ（ハッシュ化されていない）場合、5つのトランザクションのメルクル木は以下のテキスト図のようになる。

